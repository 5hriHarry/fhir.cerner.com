<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="Content-Language" content="en-us">
  <meta http-equiv="imagetoolbar" content="false">
  <title>OpenID Connect</title>
  
  <link href="../../css/reset.css" rel="stylesheet" type="text/css">
  <link href="../../css/documentation.css" media="screen" rel="stylesheet" type="text/css">
  <link href="../../css/pygments.css" media="screen" rel="stylesheet" type="text/css">
  <script src="../../js/jquery.js" type="text/javascript"></script>
  <script src="../../js/documentation.js" type="text/javascript"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-62403415-1', 'auto');
    ga('send', 'pageview');
  </script>
</head>


<body class="_api">
<div id="header">

  <div id="top-header">
    <div class="header-wrapper">

      <a class="logo" href="../../">Cerner Corporation</a>

      <nav id="navigation">
        <ul>
          <li><a target="_blank" href="http://code.cerner.com/learn">Learn</a></li>
          <li><a target="_blank" href="http://code.cerner.com/browse">Browse</a></li>
          <li><a target="_blank" href="http://code.cerner.com/build">Build</a></li>
          <li><a target="_blank" href="http://code.cerner.com/engage">Engage</a></li>
        </ul>  
      </nav>
    </div>
<!-- /.header-wrapper -->
  </div>
<!-- /#top-header -->

  <div id="bottom-header">
    <div class="header-wrapper">

      <ul class="pages">
        <li><a href="../../millennium/dstu2/" class="nav-dstu2-api">Millennium</a></li>
        <li><a href=".." class="nav-dstu2-api">Authorization</a></li>
      </ul>

    </div>
<!-- /.header-wrapper -->
  </div>
<!-- /#bottom-header -->

</div>
<!-- /#header -->


<div id="wrapper">
  <div class="content">
    
<h1 id="authorization-server-openid-connect-support">Authorization Server OpenID Connect Support</h1>

<h2 id="introduction">Introduction</h2>

<p><a href="http://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect</a> describes itself as “a simple identity layer 
on top of the OAuth 2.0 protocol”.  The specification provides a set
of message structures, a messaging protocol, and a security framework
to allow a system that has authenticated a user to securely convey said
identity to another service provider (relying party).  Cerner’s 
authorization server implements support for OpenID Connect in
conjunction with the <a href="http://docs.smarthealthit.org/authorization/">SMART on FHIR<sup>®</sup></a> profile 
of OAuth 2.  Client applications may use this as a source of 
“single sign-on” for users when protecting resources outside of the EMR 
(example: user-generated data that is stored by the client application).</p>

<p>In addition to SSO, SMART on FHIR<sup>®</sup> also leverages OpenID 
Connect to convey the location of the authenticated user’s 
FHIR<sup>®</sup> endpoint, as described by the HL7<sup>®</sup>
FHIR<sup>®</sup> standard.</p>

<h2 id="requesting-openid-connect">Requesting OpenID Connect</h2>

<p>Per <a href="http://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect</a> and <a href="http://docs.smarthealthit.org/authorization/">SMART on FHIR<sup>®</sup></a>, 
a client application requests the scope of “openid” to receive an identity
token within the access token response.</p>

<h2 id="identifying-the-user">Identifying the User</h2>

<p>Upon retrieving an access token, an identity token will be presented in
the access token response.  These are parsed as JSON web tokens per
the <a href="http://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect</a> specification.  Within identity tokens, two
values are of importance in identifying the user:</p>

<ul>
  <li>Issuer (iss)</li>
  <li>Subject (sub)</li>
</ul>

<p>The subject value of the identity assertion corresponds to the user
identifier asserted by the authentication system being used, locally
unique within context of the “issuer”.  This value may be a user’s 
username, or could be an opaque identifier, such as a UUID.  Both the 
issuer and subject value combined constitute a globally-unique
identifier for the authenticated user.</p>

<p>User identifiers remain permanent, except in the following conditions:</p>

<ul>
  <li>The EHR switches a group of users to utilize a new authentication
system.</li>
  <li>A user’s identifier is changed in the upstream authentication system.</li>
  <li>The organization changes EHR systems.</li>
</ul>

<p>Neither OpenID Connect nor SMART on FHIR<sup>®</sup> prescribe mechanisms 
for addressing the above scenarios.  As such, application developers should
consider proprietary mechansims for handling such scenarios if
critical user information is managed outside of the EHR.</p>

<h2 id="validating-openid-connect-identity-tokens">Validating OpenID Connect Identity Tokens</h2>

<p>The client application receiving the identity token must validate that 
the audience (aud) claim matches its own client identifier, per section
3.1.3.7 of <a href="http://openid.net/specs/openid-connect-core-1_0.html#IDTokenValidation">OpenID Connect Core</a>.</p>

<p>For applications interoperating only with Cerner’s authorization 
server, no explicit signature validation is required when retrieving
the access token directly from the token endpoint (as advertised via
the FHIR<sup>®</sup> conformance document).</p>

<p>For applications that interoperate with multiple implementations, or
are distributed in nature, identity tokens should be verified (including
signature) per section 3.1.3.7 of <a href="http://openid.net/specs/openid-connect-core-1_0.html#IDTokenValidation">OpenID Connect Core</a>.
Signing keys may be retrieved via the following steps:</p>

<ul>
  <li>The OpenID Provider Configuration Information should be retrieved per
section 4.1 of <a href="http://openid.net/specs/openid-connect-discovery-1_0.html#ProviderConfigurationRequest">OpenID Connect Discovery</a>.</li>
  <li>The URI of the JSON Web Key Set (“jwks_uri”) should be extracted.</li>
  <li>Examine the id of the JSON Web Key used to sign the OpenID Connect
token, and retrieve it from the JSON Web Key Set.</li>
</ul>

<p>The following is an example of an access token response containing
an OpenID Connect identity token:</p>

<pre class="terminal">
{
    "access_token": "eyJraWQiOiIyMDE2LTEyLTE0VDE2OjQ5OjIxLjQ5OS5lYyIsInR5cCI6IkpXVCIsImFsZyI6IkVTMjU2In0.eyJzdWIiOiJwb3J0YWwiLCJ1cm46Y29tOmNlcm5lcjphdXRob3JpemF0aW9uOmNsYWltcyI6eyJ2ZXIiOiIxLjAiLCJ0bnQiOiIwYjhhMDExMS1lOGU2LTRjMjYtYTkxYy01MDY5Y2JjNmIxY2EiLCJhenMiOiJ1c2VyXC9QYXRpZW50LnJlYWQgb25saW5lX2FjY2VzcyBvcGVuaWQifSwiYXpwIjoiOTRiYmQ5MGQtNDgyYS00YTEwLWI3ZGYtYjQwZWRiMjc4ZGEyIiwiaXNzIjoiaHR0cHM6XC9cL2F1dGhvcml6YXRpb24uc2FuZGJveGNlcm5lci5jb21cLyIsImV4cCI6MTQ4MTc0Nzc4NCwiaWF0IjoxNDgxNzQ3MTg0LCJqdGkiOiIzNjQ4OWEyNS04YzRjLTQ0NjEtYTJjNy1iY2U3NDE0YTUxYWIiLCJ1cm46Y2VybmVyOmF1dGhvcml6YXRpb246Y2xhaW1zOnZlcnNpb246MSI6eyJ2ZXIiOiIxLjAiLCJwcm9maWxlcyI6eyJzbWFydC12MSI6eyJhenMiOiJ1c2VyXC9QYXRpZW50LnJlYWQgb25saW5lX2FjY2VzcyBvcGVuaWQifX0sImNsaWVudCI6eyJuYW1lIjoiU2FuZGJveENsaWVudCIsImlkIjoiOTRiYmQ5MGQtNDgyYS00YTEwLWI3ZGYtYjQwZWRiMjc4ZGEyIn0sInVzZXIiOnsicHJpbmNpcGFsIjoicG9ydGFsIiwicGVyc29uYSI6InByb3ZpZGVyIiwiaWRzcCI6IjBiOGEwMTExLWU4ZTYtNGMyNi1hOTFjLTUwNjljYmM2YjFjYSIsInByaW5jaXBhbFVyaSI6Imh0dHBzOlwvXC9taWxsZW5uaWEuc2FuZGJveGNlcm5lci5jb21cL2luc3RhbmNlXC8wYjhhMDExMS1lOGU2LTRjMjYtYTkxYy01MDY5Y2JjNmIxY2FcL3ByaW5jaXBhbFwvMDAwMC4wMDAwLjAwNDQuMUQ4NyIsImlkc3BVcmkiOiJodHRwczpcL1wvbWlsbGVubmlhLnNhbmRib3hjZXJuZXIuY29tXC9hY2NvdW50c1wvZmhpcnBsYXkudGVtcF9yaG8uY2VybmVyYXNwLmNvbVwvMGI4YTAxMTEtZThlNi00YzI2LWE5MWMtNTA2OWNiYzZiMWNhXC9sb2dpbiJ9LCJ0ZW5hbnQiOiIwYjhhMDExMS1lOGU2LTRjMjYtYTkxYy01MDY5Y2JjNmIxY2EifX0.AaMZoMXUrZmnKwdAVC5uT2rbRMSOfO_zUGVJKce6o4NlUS7ECEF6Q8I0vvGkJDWfULxaqf4ITo1PUOfPnarjxw",
    "refresh_token": "daf989e2-649a-48c8-b2d8-18efa70be0ef",
    "scope": "user/Patient.read online_access openid",
    "id_token": "eyJraWQiOiIyMDE2LTEyLTE0VDE2OjQ5OjIxLjUxMS5yc2EiLCJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJwb3J0YWwiLCJhdWQiOiI5NGJiZDkwZC00ODJhLTRhMTAtYjdkZi1iNDBlZGIyNzhkYTIiLCJpc3MiOiJodHRwczpcL1wvYXV0aG9yaXphdGlvbi5zYW5kYm94Y2VybmVyLmNvbVwvdGVuYW50c1wvMGI4YTAxMTEtZThlNi00YzI2LWE5MWMtNTA2OWNiYzZiMWNhXC9vaWRjXC9pZHNwc1wvMGI4YTAxMTEtZThlNi00YzI2LWE5MWMtNTA2OWNiYzZiMWNhXC8iLCJleHAiOjE0ODE3NDc3ODQsImlhdCI6MTQ4MTc0NzE4NH0.YvF8Pqelk6Ze4srAjUnHZ192-bxaglYcbvbf8_AfDXtsmLKcSfHtQ9MmeGX5k6E-Mv4sqDEwzKPmU8p2GifOzYeJwu-TvJDCMDoqMk7WSLbb9wJk2gJ3Ipi7SEQcyVdPBGx9GMb4oX00bom0aliT2v-oGUeCcGOIPjVFM3eVaxgaHo7L_4shRX-FbUa96ORarD0c92m4PZZoiHqujCuRC7TjRfIvPXnBCCCl5naEo-gqkTNEfSf_jpfZPLAsQgW5jFcFiz9ihrBgM6A7yIE-1wSpIm9EiwY5gm3lJQTyGzYg3tzoOHIBWzbVTeTYTUlNMiwC_icHv2j9FDWHSxKTfw",
    "token_type": "Bearer",
    "expires_in": 570
}
</pre>

<p>The claims of the identity token in the above example are as follows:</p>

<pre class="terminal">
{
  "sub": "portal",
  "aud": "94bbd90d-482a-4a10-b7df-b40edb278da2",
  "iss": "https://authorization.sandboxcerner.com/tenants/0b8a0111-e8e6-4c26-a91c-5069cbc6b1ca/oidc/idsps/0b8a0111-e8e6-4c26-a91c-5069cbc6b1ca/",
  "exp": 1481747784,
  "iat": 1481747184
}
</pre>

<p>In this example, the user identifier is “portal”, the issuer is
<code>https://authorization.sandboxcerner.com/tenants/0b8a0111-e8e6-4c26-a91c-5069cbc6b1ca/oidc/idsps/0b8a0111-e8e6-4c26-a91c-5069cbc6b1ca/</code>
and the recipient client id is <code>94bbd90d-482a-4a10-b7df-b40edb278da2</code>.</p>

<p>The following is an example URL for the location of an OpenID Connect
configuration document, derived from the issuer in the above id_token:</p>

<p><code>https://authorization.sandboxcerner.com/tenants/0b8a0111-e8e6-4c26-a91c-5069cbc6b1ca/oidc/idsps/0b8a0111-e8e6-4c26-a91c-5069cbc6b1ca/.well-known/openid-configuration</code></p>

<p>The following is example content of the configuration document:</p>

<pre class="terminal">
{
    "response_types_supported": ["code"],
    "request_parameter_supported": false,
    "require_request_uri_registration": false,
    "request_uri_parameter_supported": true,
    "claims_parameter_supported": false,
    "jwks_uri": "https://authorization.sandboxcerner.com/jwk",
    "subject_types_supported": ["public"],
    "id_token_signing_alg_values_supported": ["RS256"],
    "issuer": "https://authorization.sandboxcerner.com/tenants/0b8a0111-e8e6-4c26-a91c-5069cbc6b1ca/oidc/idsps/0b8a0111-e8e6-4c26-a91c-5069cbc6b1ca/",
    "authorization_endpoint": "https://authorization.sandboxcerner.com/tenants/0b8a0111-e8e6-4c26-a91c-5069cbc6b1ca/oidc/idsps/0b8a0111-e8e6-4c26-a91c-5069cbc6b1ca/",
    "token_endpoint": "https://authorization.sandboxcerner.com/tenants/0b8a0111-e8e6-4c26-a91c-5069cbc6b1ca/oidc/idsps/0b8a0111-e8e6-4c26-a91c-5069cbc6b1ca/"
}
</pre>

<p>In this example, the jwks_uri is: <code>https://authorization.sandboxcerner.com/jwk</code></p>

<h2 id="session-management">Session Management</h2>

<p>SMART<sup>®</sup> on FHIR<sup>®</sup> currently does not prescribe
mechanisms for managing session state between applications, or
providing a sign-out experience for users.</p>

<h2 id="additional-user-information">Additional User Information</h2>

<p>Cerner’s implementation does not currently support the “profile”
scope for OpenID Connect, which would traditionally provide
access to demographic information and the FHIR<sup>®</sup>
endpoint URL for an individual.</p>


  </div>

  <div id="js-sidebar" class="sidebar-shell">
  <div class="js-toggle-list sidebar-module expandable">
    <ul>
      <li class="js-topic">
        <h3><a href="..">Authorization Overview</a></h3>
      </li>
      <li class="js-topic">
        <h3><a href="../authorization-specification">Authorization Specification (1.0)</a></h3>
      </li>
      <li class="js-topic">
        <h3><a href=".">OpenId Connect</a></h3>
      </li>
    </ul>
  </div> <!-- /sidebar-module -->
  <div class="sidebar-module notice">
    <p>This website is a <a href="https://github.com/cerner/fhir.cerner.com" target="_blank">public GitHub repository</a>. Please help us by forking the project and adding to it.</p>
  </div>
</div>
<!-- /sidebar-shell -->

</div>
<!-- #wrapper -->

<div id="footer">

  <div id="top-footer">
    <div class="footer-wrapper">

      <ul id="footer-pages">
        <li><a href="https://groups.google.com/d/forum/cerner-fhir-developers">Contact</a></li>
        <li><a href="http://engineering.cerner.com/">Blog</a></li>
        <li><a href="https://www.cerner.com/About_Cerner/">About</a></li>
      </ul>

      <ul id="social-links">
        <li><a target="_blank" href="https://www.linkedin.com/company/cerner-corporation" class="linkedin">LinkedIn</a></li>
        <li><a target="_blank" href="https://twitter.com/cerner/" class="twitter">Twitter</a></li>
        <li><a target="_blank" href="https://www.facebook.com/Cerner/" class="facebook">Facebook</a></li>
        <li><a target="_blank" href="https://www.youtube.com/user/CernerCorporation" class="youtube">YouTube</a></li>
      </ul>

    </div>
<!-- /.footer-wrapper -->
  </div>
<!-- /#top-footer -->

  <div id="bottom-footer">
    <div class="footer-wrapper">

      <p>© <span class="js-year"></span> Cerner Corporation.  All rights reserved.</p>

      <ul id="footer-legal">
        <li><a href="http://www.cerner.com/Terms_Of_Use/">Terms of Use</a></li>
        <li><a href="http://www.cerner.com/Privacy/">Privacy Policy</a></li>
        <li><a href="http://www.cerner.com/GlobalPrivacy/">Safe Harbor Guidelines</a></li>
      </ul>

    </div>
<!-- /.footer-wrapper -->
  </div>
<!-- /#bottom-footer -->

</div>
<!-- /#footer -->

</body>
</html>
